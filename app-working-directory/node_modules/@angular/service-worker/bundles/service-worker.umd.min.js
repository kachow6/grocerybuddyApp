!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("rxjs/BehaviorSubject"),require("rxjs/Observable"),require("base64-js"),require("rxjs/add/observable/concat"),require("rxjs/add/observable/defer"),require("rxjs/add/observable/empty"),require("rxjs/add/observable/from"),require("rxjs/add/observable/fromEvent"),require("rxjs/add/observable/merge"),require("rxjs/add/observable/of"),require("rxjs/add/observable/timer"),require("rxjs/add/operator/concatMap"),require("rxjs/add/operator/do"),require("rxjs/add/operator/expand"),require("rxjs/add/operator/filter"),require("rxjs/add/operator/first"),require("rxjs/add/operator/let"),require("rxjs/add/operator/map"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/operator/publishReplay"),require("rxjs/add/operator/reduce"),require("rxjs/add/operator/share"),require("rxjs/add/operator/switchMap"),require("rxjs/add/operator/take"),require("rxjs/add/operator/takeWhile")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/BehaviorSubject","rxjs/Observable","base64-js","rxjs/add/observable/concat","rxjs/add/observable/defer","rxjs/add/observable/empty","rxjs/add/observable/from","rxjs/add/observable/fromEvent","rxjs/add/observable/merge","rxjs/add/observable/of","rxjs/add/observable/timer","rxjs/add/operator/concatMap","rxjs/add/operator/do","rxjs/add/operator/expand","rxjs/add/operator/filter","rxjs/add/operator/first","rxjs/add/operator/let","rxjs/add/operator/map","rxjs/add/operator/mergeMap","rxjs/add/operator/publishReplay","rxjs/add/operator/reduce","rxjs/add/operator/share","rxjs/add/operator/switchMap","rxjs/add/operator/take","rxjs/add/operator/takeWhile"],r):r((e.ng=e.ng||{},e.ng.serviceWorker=e.ng.serviceWorker||{}),e.ng.core,e.Rx,e.Rx,e.Base64Js,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx,e.Rx)}(this,function(e,r,t,o,n,a,i,s,u,c,d,p,f,l,b,x,v,h,j,g,y,m,R,k,q,W,O){"use strict";function w(e){return o.Observable.create(function(r){e().then(function(e){return r.next(e)}).then(function(){return r.complete()}).catch(function(e){return r.error(e)})})}var S=function(e,r,t,o){var n,a=arguments.length,i=a<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,t,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(r,t,i):n(r,t))||i);return a>3&&i&&Object.defineProperty(r,t,i),i},M=function(e,r){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,r)},P=function(){function e(e){this.ps=e}return e.prototype.auth=function(){return this.key("auth")},e.prototype.key=function(e){return void 0===e&&(e="p256dh"),n.fromByteArray(new Uint8Array(this.ps.getKey(e)))},Object.defineProperty(e.prototype,"url",{get:function(){return this.ps.endpoint},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return this.ps.toJSON()},e.prototype.unsubscribe=function(){var e=this;return w(function(){return e.ps.unsubscribe()})},e}();e.NgServiceWorker=function(){function e(e){var r=this;this.zone=e,this.controllingWorker=new t.BehaviorSubject(void 0),this.container="object"==typeof navigator&&navigator.serviceWorker,this.container&&o.Observable.concat(o.Observable.of(this.container.controller),o.Observable.fromEvent(this.container,"controllerchange").map(function(e){return r.container.controller})).subscribe(function(e){return r.controllingWorker.next(e)},function(e){return r.controllingWorker.error(e)},function(){return r.controllingWorker.complete()}),this.awaitSingleControllingWorker=this.controllingWorker.filter(function(e){return!!e}).take(1),this.push=o.Observable.defer(function(){return r.send({cmd:"push"})}).share(),this.updates=o.Observable.defer(function(){return r.send({cmd:"update"})}).share()}return e.prototype.registrationForWorker=function(){var e=this;return function(r){return r.switchMap(function(r){return w(function(){return e.container.getRegistrations()}).expand(function(e){return o.Observable.from(e)}).filter(function(e){return e.active===r}).take(1)})}},e.prototype.sendToWorker=function(e,r){var t=this,n=new MessageChannel,a=new o.Observable(function(r){var o=null,a=function(e){var t=e.data;if(t&&"object"==typeof t&&t.hasOwnProperty("$ngsw")&&t.hasOwnProperty("id"))o=t.id;else{if(null===t)return r.complete(),void n.port1.removeEventListener("message",a);r.next(t)}};return n.port1.addEventListener("message",a),function(){n.port1.removeEventListener("message",a),t.sendToWorker(e,{cmd:"cancel",id:o})}}).takeWhile(function(e){return!!e}).publishReplay();return a.connect(),n.port1.start(),r.$ngsw=!0,e.postMessage(r,[n.port2]),a},e.prototype.send=function(e){var r=this;return this.awaitSingleControllingWorker.switchMap(function(t){return r.sendToWorker(t,e)})},e.prototype.ping=function(){return this.send({cmd:"ping"})},e.prototype.log=function(){return this.send({cmd:"log"})},e.prototype.activateUpdate=function(e){return this.send({cmd:"activateUpdate",version:e})},e.prototype.registerForPush=function(e){var r=this;return void 0===e&&(e={}),this.awaitSingleControllingWorker.let(this.registrationForWorker()).map(function(e){return e.pushManager}).switchMap(function(t){var n=o.Observable.create(function(o){var n=function(e){return new P(e)};t.getSubscription().then(function(r){if(r)return n(r);var o={userVisibleOnly:!0};if(e.applicationServerKey){for(var a=atob(e.applicationServerKey.replace(/_/g,"/").replace(/-/g,"+")),i=new Uint8Array(new ArrayBuffer(a.length)),s=0;s<a.length;s++)i[s]=a.charCodeAt(s);o.applicationServerKey=i}return t.subscribe(o).then(n)}).then(function(e){return r.zone.run(function(){return o.next(e)})}).then(function(){return r.zone.run(function(){return o.complete()})}).catch(function(e){return r.zone.run(function(){return o.error(e)})})});return n})},e.prototype.checkForUpdate=function(){return this.send({cmd:"checkUpdate"})},e}(),e.NgServiceWorker=S([r.Injectable(),M("design:paramtypes",[r.NgZone])],e.NgServiceWorker);var N=function(e,r,t,o){var n,a=arguments.length,i=a<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,t,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(r,t,i):n(r,t))||i);return a>3&&i&&Object.defineProperty(r,t,i),i};e.ServiceWorkerModule=function(){function e(){}return e}(),e.ServiceWorkerModule=N([r.NgModule({providers:[e.NgServiceWorker]})],e.ServiceWorkerModule),e.NgPushRegistration=P,Object.defineProperty(e,"__esModule",{value:!0})});